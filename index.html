<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // =======================
    // BASE DE DADOS PRODUTOS HOLANDA (PORTUGU√äS)
    // =======================
    const PRODUTOS_HOLANDA = {
        "8710400233251": { nome: "Peito de Frango AH", loja: "Albert Heijn", preco: 4.99, categoria: "Prote√≠na", quantidade: "300g" },
        "20917791": { nome: "Ovos Lidl 10 un", loja: "Lidl", preco: 2.99, categoria: "Prote√≠na", quantidade: "10 unidades" },
        "8710400018995": { nome: "Arroz Branco AH", loja: "Albert Heijn", preco: 1.29, categoria: "Hidratos", quantidade: "1kg" },
        "8710400583684": { nome: "Feij√£o Castanho AH", loja: "Albert Heijn", preco: 0.89, categoria: "Leguminosas", quantidade: "400g" },
        "8718452169412": { nome: "Esparguete Jumbo", loja: "Jumbo", preco: 0.75, categoria: "Hidratos", quantidade: "500g" },
        "8719743404786": { nome: "Ovos AH 6 un", loja: "Albert Heijn", preco: 2.45, categoria: "Prote√≠na", quantidade: "6 unidades" },
        "8712566483402": { nome: "Frango Gyros AH", loja: "Albert Heijn", preco: 5.49, categoria: "Prote√≠na", quantidade: "400g" },
        "8710400594758": { nome: "Gr√£o de Bico AH", loja: "Albert Heijn", preco: 0.95, categoria: "Leguminosas", quantidade: "400g" },
        "8710400019008": { nome: "Arroz Integral AH", loja: "Albert Heijn", preco: 1.49, categoria: "Hidratos", quantidade: "1kg" },
        "8718452203208": { nome: "Atum Natural Jumbo", loja: "Jumbo", preco: 1.25, categoria: "Prote√≠na", quantidade: "160g" }
    };

    // =======================
    // BASE DE DADOS DE RECEITAS
    // =======================
    const RECEITAS_BASE = [
        {
            id: 1,
            nome: "Feij√£o Moldavo Simples",
            origem: "Moldava",
            ingredientes: [
                { nome: "Feij√£o", quantidade: 400, unidade: "g" },
                { nome: "Cebola", quantidade: 1, unidade: "unidade" },
                { nome: "√ìleo", quantidade: 2, unidade: "colheres" }
            ],
            doses: 3,
            tempo: 5,
            duracao_frigo: 3,
            custo_estimado: 1.50,
            instrucoes: [
                "Abrir a lata de feij√£o e escorrer",
                "Cortar a cebola em peda√ßos pequenos",
                "Misturar feij√£o + cebola + √≥leo + sal",
                "Pode comer frio ou morno"
            ],
            tags: ["minimalista", "moldava", "frio"]
        },
        {
            id: 2,
            nome: "Frango com Arroz",
            origem: "Base",
            ingredientes: [
                { nome: "Frango", quantidade: 300, unidade: "g" },
                { nome: "Arroz", quantidade: 200, unidade: "g" },
                { nome: "Cebola", quantidade: 1, unidade: "unidade" },
                { nome: "√ìleo", quantidade: 3, unidade: "colheres" }
            ],
            doses: 4,
            tempo: 30,
            duracao_frigo: 3,
            custo_estimado: 4.00,
            instrucoes: [
                "Cortar o frango em cubos",
                "Refogar a cebola no √≥leo",
                "Adicionar o frango e cozinhar",
                "Cozinhar o arroz separadamente",
                "Misturar tudo"
            ],
            tags: ["panela_grande", "prote√≠na"]
        },
        {
            id: 3,
            nome: "Ovos Mexidos",
            origem: "Emerg√™ncia",
            ingredientes: [
                { nome: "Ovos", quantidade: 3, unidade: "unidades" },
                { nome: "√ìleo", quantidade: 1, unidade: "colher" }
            ],
            doses: 1,
            tempo: 5,
            duracao_frigo: 0,
            custo_estimado: 0.75,
            instrucoes: [
                "Bater os ovos",
                "Aquecer √≥leo na frigideira",
                "Adicionar os ovos e mexer",
                "Servir imediatamente"
            ],
            tags: ["r√°pido", "emerg√™ncia", "prote√≠na"]
        },
        {
            id: 4,
            nome: "Arroz com Ovos",
            origem: "Base",
            ingredientes: [
                { nome: "Arroz", quantidade: 200, unidade: "g" },
                { nome: "Ovos", quantidade: 3, unidade: "unidades" },
                { nome: "Cebola", quantidade: 1, unidade: "unidade" },
                { nome: "√ìleo", quantidade: 2, unidade: "colheres" }
            ],
            doses: 3,
            tempo: 20,
            duracao_frigo: 2,
            custo_estimado: 2.00,
            instrucoes: [
                "Cozinhar o arroz",
                "Refogar a cebola",
                "Adicionar os ovos batidos",
                "Misturar com o arroz"
            ],
            tags: ["simples", "prote√≠na", "barato"]
        },
        {
            id: 5,
            nome: "Gr√£o com Atum",
            origem: "Portuguesa",
            ingredientes: [
                { nome: "Gr√£o", quantidade: 400, unidade: "g" },
                { nome: "Atum", quantidade: 120, unidade: "g" },
                { nome: "Cebola", quantidade: 1, unidade: "unidade" },
                { nome: "Azeite", quantidade: 3, unidade: "colheres" }
            ],
            doses: 3,
            tempo: 5,
            duracao_frigo: 2,
            custo_estimado: 2.50,
            instrucoes: [
                "Escorrer o gr√£o e o atum",
                "Cortar a cebola em rodelas finas",
                "Misturar tudo com azeite",
                "Temperar com sal"
            ],
            tags: ["minimalista", "frio", "portuguesa"]
        }
    ];

    // =======================
    // FUN√á√ïES DE C√ÅLCULO
    // =======================
    function calcularPrioridade(item) {
        const agora = new Date();
        const diasDesdeEntrada = Math.floor((agora - new Date(item.data_entrada)) / (1000 * 60 * 60 * 24));
        
        if (item.estado === "cozinhado") {
            if (diasDesdeEntrada >= 3) return { nivel: 1, texto: "Consumir J√Å", badge: "urgent" };
            if (diasDesdeEntrada === 2) return { nivel: 2, texto: "Hoje/amanh√£", badge: "warning" };
            return { nivel: 3, texto: "OK", badge: "ok" };
        }
        
        if (item.estado === "aberto") {
            if (diasDesdeEntrada >= 3) return { nivel: 2, texto: "Consumir breve", badge: "warning" };
            return { nivel: 3, texto: "OK", badge: "ok" };
        }
        
        if (item.estado === "cru") {
            if (diasDesdeEntrada >= 4) return { nivel: 2, texto: "Cozinhar j√°", badge: "warning" };
            return { nivel: 4, texto: "OK", badge: "ok" };
        }
        
        return { nivel: 5, texto: "Seguro", badge: "safe" };
    }

    // FUN√á√ÉO CORRIGIDA: Normalizar nomes para matching
    function normalizarNome(nome) {
        return nome.toLowerCase()
            .replace(/\s+ah$/i, '')
            .replace(/\s+jumbo$/i, '')
            .replace(/\s+lidl$/i, '')
            .replace(/\s+de\s+/gi, ' ')
            .replace(/\s+com\s+/gi, ' ')
            .replace(/integral/gi, '')
            .replace(/branco/gi, '')
            .replace(/castanho/gi, '')
            .replace(/natural/gi, '')
            .replace(/cozido/gi, '')
            .replace(/\s+/g, ' ')
            .trim();
    }

    // FUN√á√ÉO CORRIGIDA: Verificar se ingrediente est√° dispon√≠vel
    function temIngrediente(ingredienteReceita, inventario) {
        const ingNormalizado = normalizarNome(ingredienteReceita);
        const palavrasChave = ingNormalizado.split(' ')[0]; // Primeira palavra √© a mais importante
        
        return inventario.some(produto => {
            const prodNormalizado = normalizarNome(produto);
            // Match se a palavra-chave do ingrediente aparece no produto
            return prodNormalizado.includes(palavrasChave) || palavrasChave.includes(prodNormalizado);
        });
    }

    // FUN√á√ÉO CORRIGIDA: Encontrar melhor receita
    function encontrarMelhorReceita(items, receitas) {
        if (items.length === 0) {
            return receitas.find(r => r.tags.includes("minimalista")) || receitas[0];
        }
        
        // Lista de nomes dos produtos no invent√°rio
        const inventario = items.map(i => i.nome);
        
        // Calcular score de cada receita
        const receitasComScore = receitas.map(receita => {
            let matches = 0;
            const totalIngredientes = receita.ingredientes.length;
            
            receita.ingredientes.forEach(ing => {
                if (temIngrediente(ing.nome, inventario)) {
                    matches++;
                }
            });
            
            const score = matches / totalIngredientes;
            
            return {
                receita,
                score,
                matches,
                ingredientesFaltam: totalIngredientes - matches
            };
        });
        
        // Ordenar por:
        // 1. Maior score (mais ingredientes dispon√≠veis)
        // 2. Se empate, menor custo
        receitasComScore.sort((a, b) => {
            if (Math.abs(b.score - a.score) > 0.01) { // Diferen√ßa significativa
                return b.score - a.score;
            }
            return a.receita.custo_estimado - b.receita.custo_estimado;
        });
        
        // Debug (remover depois de testar)
        console.log("=== AN√ÅLISE DE RECEITAS ===");
        receitasComScore.forEach(r => {
            console.log(`${r.receita.nome}: ${r.matches}/${r.receita.ingredientes.length} ingredientes (${(r.score * 100).toFixed(0)}%)`);
        });
        
        // Se nenhuma receita tem pelo menos 25% dos ingredientes, retorna a mais barata
        if (receitasComScore[0].score < 0.25) {
            console.log("‚ö†Ô∏è Nenhuma receita tem ingredientes suficientes, sugerindo a mais barata");
            return receitas.reduce((mais_barata, r) => 
                r.custo_estimado < mais_barata.custo_estimado ? r : mais_barata
            );
        }
        
        console.log(`‚úÖ Melhor receita: ${receitasComScore[0].receita.nome}`);
        return receitasComScore[0].receita;
    }

    function gerarSugestao(items, receitas) {
        const comidaPronta = items.filter(i => i.estado === "cozinhado" && calcularPrioridade(i).nivel >= 3);
        const itensUrgentes = items.filter(i => calcularPrioridade(i).nivel <= 2);
        
        if (comidaPronta.length > 0) {
            return {
                tipo: "no-cook",
                titulo: "‚úÖ N√£o cozinhar hoje",
                mensagem: `Tens ${comidaPronta.length} refei√ß√£o/√µes pronta(s).`,
                items: comidaPronta,
                receita: null
            };
        }
        
        if (itensUrgentes.length > 0) {
            const receitaSugerida = encontrarMelhorReceita(items, receitas);
            
            return {
                tipo: "urgent",
                titulo: "üî¥ Cozinhar hoje",
                mensagem: `${itensUrgentes.length} item(ns) a estragar.`,
                items: itensUrgentes,
                receita: receitaSugerida
            };
        }
        
        const temProteina = items.some(i => i.categoria === "Prote√≠na" && i.estado === "cru");
        if (temProteina) {
            const receitaSugerida = encontrarMelhorReceita(items, receitas);
            
            return {
                tipo: "warning",
                titulo: "‚ö†Ô∏è Sem comida pronta",
                mensagem: "Tens ingredientes frescos dispon√≠veis.",
                receita: receitaSugerida
            };
        }
        
        return {
            tipo: "ok",
            titulo: "üòå Invent√°rio baixo",
            mensagem: "Considera fazer compras em breve.",
            receita: null
        };
    }

    function calcularGastos(items) {
        const agora = new Date();
        const semanaAtras = new Date(agora.getTime() - 7 * 24 * 60 * 60 * 1000);
        const mesAtras = new Date(agora.getTime() - 30 * 24 * 60 * 60 * 1000);
        
        const itemsSemana = items.filter(i => new Date(i.data_entrada) >= semanaAtras);
        const itemsMes = items.filter(i => new Date(i.data_entrada) >= mesAtras);
        
        const gastoSemana = itemsSemana.reduce((sum, i) => sum + (parseFloat(i.preco) || 0), 0);
        const gastoMes = itemsMes.reduce((sum, i) => sum + (parseFloat(i.preco) || 0), 0);
        
        return {
            semana: { total: gastoSemana, items: itemsSemana.length },
            mes: { total: gastoMes, items: itemsMes.length }
        };
    }

    function agruparCompras(items) {
        const comprasPorData = {};
        
        items.forEach(item => {
            const data = new Date(item.data_entrada).toLocaleDateString('pt-PT');
            if (!comprasPorData[data]) {
                comprasPorData[data] = {
                    data: item.data_entrada,
                    loja: item.loja,
                    items: [],
                    total: 0
                };
            }
            comprasPorData[data].items.push(item);
            comprasPorData[data].total += parseFloat(item.preco) || 0;
        });
        
        return Object.values(comprasPorData).sort((a, b) => 
            new Date(b.data) - new Date(a.data)
        );
    }

    // =======================
    // COMPONENTE PRINCIPAL
    // =======================
    function App() {
        const [activeTab, setActiveTab] = useState('home');
        const [items, setItems] = useState(() => {
            const saved = localStorage.getItem('poupanca-holanda-items');
            return saved ? JSON.parse(saved).map(item => ({
                ...item,
                data_entrada: new Date(item.data_entrada)
            })) : [];
        });
        
        const [productDatabase, setProductDatabase] = useState(() => {
            const saved = localStorage.getItem('poupanca-holanda-products');
            return saved ? JSON.parse(saved) : PRODUTOS_HOLANDA;
        });
        
        const [showSuggestion, setShowSuggestion] = useState(false);
        const [showScanModal, setShowScanModal] = useState(false);
        const [showConfirmModal, setShowConfirmModal] = useState(false);
        const [showManualModal, setShowManualModal] = useState(false);
        const [showConsumeModal, setShowConsumeModal] = useState(false);
        const [showRecipeModal, setShowRecipeModal] = useState(false);
        const [selectedRecipe, setSelectedRecipe] = useState(null);
        const [selectedItem, setSelectedItem] = useState(null);
        const [scannedProduct, setScannedProduct] = useState(null);
        const [scanning, setScanning] = useState(false);
        const scannerRef = useRef(null);
        
        const [consumeAmount, setConsumeAmount] = useState("");
        
        const [manualProduct, setManualProduct] = useState({
            codigo_barras: "",
            nome: "",
            categoria: "Prote√≠na",
            quantidade: "",
            estado: "cru",
            preco: "",
            loja: ""
        });
        
        useEffect(() => {
            localStorage.setItem('poupanca-holanda-items', JSON.stringify(items));
        }, [items]);
        
        useEffect(() => {
            localStorage.setItem('poupanca-holanda-products', JSON.stringify(productDatabase));
        }, [productDatabase]);
        
        const categorias = {
            "Prote√≠na": "ü•©",
            "Hidratos": "üçö",
            "Leguminosas": "ü´ò",
            "Vegetais": "ü•¨",
            "Extras": "üßÇ"
        };
        
        const gastos = calcularGastos(items);
        const compras = agruparCompras(items);
        const custoTotal = items.reduce((sum, item) => sum + (parseFloat(item.preco) || 0), 0);
        const sugestao = gerarSugestao(items, RECEITAS_BASE);
        
        const handleConsumeItem = (item) => {
            setSelectedItem(item);
            setConsumeAmount("");
            setShowConsumeModal(true);
        };
        
        const handleConfirmConsume = () => {
            if (!consumeAmount) {
                alert("Indica quanto sobra");
                return;
            }
            
            const unidade = selectedItem.quantidade.split(' ').slice(1).join(' ');
            const novaQuantidade = `${consumeAmount} ${unidade}`;
            
            const updatedItems = items.map(i => 
                i.id === selectedItem.id 
                    ? { ...i, quantidade: novaQuantidade }
                    : i
            );
            
            setItems(updatedItems);
            setShowConsumeModal(false);
            setSelectedItem(null);
            setConsumeAmount("");
        };
        
        const handleScanSuccess = (barcode) => {
            if (scannerRef.current) {
                scannerRef.current.stop();
            }
            setScanning(false);
            setShowScanModal(false);
            
            const produtoPessoal = items.find(i => i.codigo_barras === barcode);
            if (produtoPessoal) {
                setScannedProduct({
                    ...produtoPessoal,
                    fonte: "pessoal"
                });
                setShowConfirmModal(true);
                return;
            }
            
            const produtoHolanda = productDatabase[barcode];
            if (produtoHolanda) {
                setScannedProduct({
                    codigo_barras: barcode,
                    ...produtoHolanda,
                    estado: "cru",
                    fonte: "holanda"
                });
                setShowConfirmModal(true);
                return;
            }
            
            setManualProduct({
                codigo_barras: barcode,
                nome: "",
                categoria: "Prote√≠na",
                quantidade: "",
                estado: "cru",
                preco: "",
                loja: ""
            });
            setShowManualModal(true);
        };
        
        const handleConfirmProduct = (customPrice = null) => {
            const novoItem = {
                id: Date.now(),
                codigo_barras: scannedProduct.codigo_barras,
                nome: scannedProduct.nome,
                categoria: scannedProduct.categoria,
                quantidade: scannedProduct.quantidade,
                estado: scannedProduct.estado,
                preco: customPrice !== null ? customPrice : scannedProduct.preco,
                loja: scannedProduct.loja,
                data_entrada: new Date()
            };
            
            setItems([...items, novoItem]);
            
            if (scannedProduct.fonte === "holanda" || customPrice !== null) {
                const novoDB = {
                    ...productDatabase,
                    [scannedProduct.codigo_barras]: {
                        nome: scannedProduct.nome,
                        loja: scannedProduct.loja,
                        preco: customPrice !== null ? customPrice : scannedProduct.preco,
                        categoria: scannedProduct.categoria,
                        quantidade: scannedProduct.quantidade
                    }
                };
                setProductDatabase(novoDB);
            }
            
            setShowConfirmModal(false);
            setScannedProduct(null);
        };
        
        const handleManualAdd = () => {
            if (!manualProduct.nome || !manualProduct.preco) {
                alert("Preenche pelo menos o nome e o pre√ßo");
                return;
            }
            
            const novoItem = {
                id: Date.now(),
                ...manualProduct,
                preco: parseFloat(manualProduct.preco),
                data_entrada: new Date()
            };
            
            setItems([...items, novoItem]);
            
            if (manualProduct.codigo_barras) {
                const novoDB = {
                    ...productDatabase,
                    [manualProduct.codigo_barras]: {
                        nome: manualProduct.nome,
                        loja: manualProduct.loja,
                        preco: parseFloat(manualProduct.preco),
                        categoria: manualProduct.categoria,
                        quantidade: manualProduct.quantidade
                    }
                };
                setProductDatabase(novoDB);
            }
            
            setManualProduct({
                codigo_barras: "",
                nome: "",
                categoria: "Prote√≠na",
                quantidade: "",
                estado: "cru",
                preco: "",
                loja: ""
            });
            setShowManualModal(false);
        };
        
        const handleDeleteItem = (id) => {
            if (confirm("Remover este item completamente?")) {
                setItems(items.filter(i => i.id !== id));
            }
        };
        
        const startScanner = () => {
            setScanning(true);
            setTimeout(() => {
                const html5QrCode = new Html5Qrcode("reader");
                html5QrCode.start(
                    { facingMode: "environment" },
                    { fps: 10, qrbox: 250 },
                    (decodedText) => {
                        handleScanSuccess(decodedText);
                    },
                    (error) => {}
                ).catch(err => {
                    alert("Erro ao aceder √† c√¢mara");
                    setScanning(false);
                });
                
                scannerRef.current = html5QrCode;
            }, 100);
        };
        
        const stopScanner = () => {
            if (scannerRef.current) {
                scannerRef.current.stop();
                setScanning(false);
            }
            setShowScanModal(false);
        };
        
        useEffect(() => {
            return () => {
                if (scannerRef.current) {
                    scannerRef.current.stop();
                }
            };
        }, []);
        
        const renderHome = () => (
            <>
                <div className="stats">
                    <div className="stat-card">
                        <div className="stat-value">‚Ç¨{custoTotal.toFixed(2)}</div>
                        <div className="stat-label">Em stock</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-value">{items.length}</div>
                        <div className="stat-label">Produtos</div>
                    </div>
                </div>
                
                <button 
                    className="btn-primary"
                    onClick={() => setShowSuggestion(!showSuggestion)}
                >
                    <span>ü§î</span>
                    <span>{showSuggestion ? "Esconder" : "O que cozinho hoje?"}</span>
                </button>
                
                {showSuggestion && (
                    <div className={`suggestion-box ${sugestao.tipo}`}>
                        <h2>{sugestao.titulo}</h2>
                        <p style={{marginBottom: '12px', fontSize: '14px'}}>{sugestao.mensagem}</p>
                        
                        {sugestao.items && sugestao.items.length > 0 && (
                            <ul style={{marginLeft: '20px', marginBottom: '12px', fontSize: '14px'}}>
                                {sugestao.items.map(item => (
                                    <li key={item.id}>{item.nome} ({item.quantidade})</li>
                                ))}
                            </ul>
                        )}
                        
                        {sugestao.receita && (
                            <div className="recipe-card" style={{marginTop: '12px', cursor: 'pointer'}}
                                 onClick={() => {
                                     setSelectedRecipe(sugestao.receita);
                                     setShowRecipeModal(true);
                                 }}>
                                <div className="recipe-header">
                                    <div>
                                        <div className="recipe-title">{sugestao.receita.nome}</div>
                                        <div className="recipe-origin">{sugestao.receita.origem}</div>
                                    </div>
                                    <div className="recipe-cost">
                                        <div className="cost-total">‚Ç¨{sugestao.receita.custo_estimado.toFixed(2)}</div>
                                        <div className="cost-dose">‚Ç¨{(sugestao.receita.custo_estimado / sugestao.receita.doses).toFixed(2)}/dose</div>
                                    </div>
                                </div>
                                <div className="recipe-info">
                                    <span>‚è±Ô∏è {sugestao.receita.tempo} min</span>
                                    <span>üçΩÔ∏è {sugestao.receita.doses} doses</span>
                                    <span>‚ùÑÔ∏è {sugestao.receita.duracao_frigo} dias</span>
                                </div>
                            </div>
                        )}
                    </div>
                )}
                
                <button 
                    className="btn-primary btn-scan"
                    onClick={() => setShowScanModal(true)}
                >
                    <span>üì∑</span>
                    <span>Scan c√≥digo de barras</span>
                </button>
                
                {items.length === 0 && (
                    <div style={{textAlign: 'center', padding: '40px 20px', color: '#666'}}>
                        <div style={{fontSize: '48px', marginBottom: '16px'}}>üõí</div>
                        <p>Ainda n√£o tens produtos.</p>
                        <p style={{fontSize: '14px', marginTop: '8px'}}>Usa o scanner para come√ßar!</p>
                    </div>
                )}
                
                {Object.entries(categorias).map(([categoria, icon]) => {
                    const itensCategoria = items.filter(i => i.categoria === categoria);
                    if (itensCategoria.length === 0) return null;
                    
                    return (
                        <div key={categoria} className="category">
                            <h3>
                                <span>{icon}</span>
                                <span>{categoria}</span>
                            </h3>
                            {itensCategoria.map(item => {
                                const prioridade = calcularPrioridade(item);
                                return (
                                    <div key={item.id} className="item">
                                        <div className="item-info">
                                            <div className="item-name">{item.nome}</div>
                                            <div className="item-details">
                                                {item.quantidade} ‚Ä¢ {item.estado} ‚Ä¢ ‚Ç¨{item.preco} ‚Ä¢ {item.loja}
                                            </div>
                                        </div>
                                        <div className="item-actions">
                                            <span className={`badge badge-${prioridade.badge}`}>
                                                {prioridade.texto}
                                            </span>
                                            <button 
                                                className="btn-consume"
                                                onClick={() => handleConsumeItem(item)}
                                            >
                                                üìâ
                                            </button>
                                            <button 
                                                className="btn-delete"
                                                onClick={() => handleDeleteItem(item.id)}
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    );
                })}
            </>
        );
        
        const renderReceitas = () => (
            <>
                <div style={{marginBottom: '16px'}}>
                    <h2 style={{fontSize: '20px', marginBottom: '12px'}}>Receitas Dispon√≠veis</h2>
                    <p style={{fontSize: '14px', color: '#666'}}>Clica para ver detalhes</p>
                </div>
                
                {RECEITAS_BASE.map(receita => (
                    <div key={receita.id} className="recipe-card" 
                         onClick={() => {
                             setSelectedRecipe(receita);
                             setShowRecipeModal(true);
                         }}
                         style={{cursor: 'pointer'}}>
                        <div className="recipe-header">
                            <div>
                                <div className="recipe-title">{receita.nome}</div>
                                <div className="recipe-origin">{receita.origem}</div>
                            </div>
                            <div className="recipe-cost">
                                <div className="cost-total">‚Ç¨{receita.custo_estimado.toFixed(2)}</div>
                                <div className="cost-dose">‚Ç¨{(receita.custo_estimado / receita.doses).toFixed(2)}/dose</div>
                            </div>
                        </div>
                        <div className="recipe-info">
                            <span>‚è±Ô∏è {receita.tempo} min</span>
                            <span>üçΩÔ∏è {receita.doses} doses</span>
                            <span>‚ùÑÔ∏è {receita.duracao_frigo} dias</span>
                        </div>
                    </div>
                ))}
            </>
        );
        
        const renderGastos = () => (
            <>
                <h2 style={{fontSize: '20px', marginBottom: '16px'}}>üí∞ Gastos</h2>
                
                <div className="stats">
                    <div className="stat-card">
                        <div className="stat-label">Esta Semana</div>
                        <div className="stat-value">‚Ç¨{gastos.semana.total.toFixed(2)}</div>
                        <div className="stat-label">{gastos.semana.items} produtos</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">Este M√™s</div>
                        <div className="stat-value">‚Ç¨{gastos.mes.total.toFixed(2)}</div>
                        <div className="stat-label">{gastos.mes.items} produtos</div>
                    </div>
                </div>
                
                <h3 style={{fontSize: '16px', marginTop: '24px', marginBottom: '12px'}}>üì¶ √öltimas Compras</h3>
                
                {compras.length === 0 ? (
                    <div style={{textAlign: 'center', padding: '40px 20px', color: '#666'}}>
                        <p>Ainda n√£o h√° compras.</p>
                    </div>
                ) : (
                    compras.map((compra, idx) => (
                        <div key={idx} className="purchase-card">
                            <div className="purchase-header">
                                <div>
                                    <div className="purchase-date">
                                        üõí {new Date(compra.data).toLocaleDateString('pt-PT', { 
                                            day: 'numeric', 
                                            month: 'short' 
                                        })}
                                    </div>
                                    <div className="purchase-store">{compra.loja}</div>
                                </div>
                                <div className="purchase-total">‚Ç¨{compra.total.toFixed(2)}</div>
                            </div>
                            <div className="purchase-items">
                                {compra.items.map(item => (
                                    <div key={item.id} className="purchase-item">
                                        <span>‚Ä¢ {item.nome}</span>
                                        <span>‚Ç¨{item.preco}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))
                )}
            </>
        );
        
        return (
            <>
                <div className="header">
                    <h1>
                        <span>üá≥üá±</span>
                        <span>Poupan√ßa Holanda</span>
                    </h1>
                    <p>M√°xima poupan√ßa, zero desperd√≠cio</p>
                </div>
                
                <div className="container">
                    {activeTab === 'home' && renderHome()}
                    {activeTab === 'receitas' && renderReceitas()}
                    {activeTab === 'gastos' && renderGastos()}
                </div>
                
                <div className="bottom-nav">
                    <button 
                        className={`nav-item ${activeTab === 'home' ? 'active' : ''}`}
                        onClick={() => setActiveTab('home')}
                    >
                        <div className="nav-icon">üè†</div>
                        <div className="nav-label">In√≠cio</div>
                    </button>
                    <button 
                        className={`nav-item ${activeTab === 'receitas' ? 'active' : ''}`}
                        onClick={() => setActiveTab('receitas')}
                    >
                        <div className="nav-icon">üìñ</div>
                        <div className="nav-label">Receitas</div>
                    </button>
                    <button 
                        className={`nav-item ${activeTab === 'gastos' ? 'active' : ''}`}
                        onClick={() => setActiveTab('gastos')}
                    >
                        <div className="nav-icon">üí∞</div>
                        <div className="nav-label">Gastos</div>
                    </button>
                </div>
                
                {/* Modals continuam iguais... */}
                {/* (c√≥digo dos modais n√£o mudou, n√£o preciso repetir) */}
            </>
        );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
