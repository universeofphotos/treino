<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food Control Pro</title>

<style>
body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
    background:#0c0c0c;
    color:#fff;
}

header{
    padding:20px;
    font-size:22px;
    font-weight:600;
    text-align:center;
    background:linear-gradient(90deg,#00c853,#009624);
}

.container{padding:15px;}

.section-title{
    margin-top:25px;
    font-size:18px;
    font-weight:600;
    opacity:0.8;
}

.card{
    background:#1a1a1a;
    padding:15px;
    border-radius:14px;
    margin-bottom:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.4);
}

button{
    padding:10px 14px;
    border:none;
    border-radius:10px;
    margin:4px 0;
    cursor:pointer;
    font-weight:500;
}

.primary{background:#00c853;color:white;}
.secondary{background:#2a2a2a;color:white;}
.danger{background:#b00020;color:white;}
.warning{background:#ff6d00;color:white;}

input,select{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
    background:#2a2a2a;
    color:white;
}

.modal{
    display:none;
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}

.modal-content{
    background:#1e1e1e;
    padding:20px;
    border-radius:16px;
    width:90%;
    max-width:400px;
}

.low-stock{
    border:2px solid #ff6d00;
}

.progress-bar{
    height:8px;
    background:#333;
    border-radius:10px;
    overflow:hidden;
    margin-top:8px;
}

.progress{
    height:8px;
    background:#00c853;
}
</style>
</head>
<body>

<header>üç≤ Food Control Pro</header>

<div class="container">

<button class="primary" onclick="openAdd()">+ Produto</button>
<button class="secondary" onclick="openMeal()">+ Refei√ß√£o</button>

<div class="section-title">üì¶ Invent√°rio</div>
<div id="inventory"></div>

<div class="section-title">üõí Lista de Compras</div>
<div id="shopping"></div>

<div class="section-title">üìä Dashboard</div>
<div id="dashboard"></div>

<div class="section-title">üìú Hist√≥rico</div>
<div id="history"></div>

</div>

<!-- Modal Produto -->
<div class="modal" id="productModal">
<div class="modal-content">
<h3 id="modalTitle">Adicionar Produto</h3>
<input id="name" placeholder="Nome">
<input id="price" type="number" placeholder="Pre√ßo total ‚Ç¨">
<input id="quantity" type="number" placeholder="Quantidade">
<input id="unit" placeholder="Unidade (g, kg, un)">
<button class="primary" onclick="saveProduct()">Guardar</button>
<button class="secondary" onclick="closeModal()">Cancelar</button>
</div>
</div>

<!-- Modal Refei√ß√£o -->
<div class="modal" id="mealModal">
<div class="modal-content">
<h3>Registar Consumo</h3>
<select id="mealItem"></select>
<input id="useQuantity" type="number" placeholder="Quantidade usada">
<button class="primary" onclick="addMeal()">Registar</button>
<button class="secondary" onclick="closeModal()">Cancelar</button>
</div>
</div>

<script>

let inventory = JSON.parse(localStorage.getItem("inventory")) || [];
let meals = JSON.parse(localStorage.getItem("meals")) || [];
let salary = 1960;
let budget = 80;
let editIndex = null;

function saveStorage(){
    localStorage.setItem("inventory", JSON.stringify(inventory));
    localStorage.setItem("meals", JSON.stringify(meals));
}

function openAdd(){
    editIndex = null;
    modalTitle.innerText="Adicionar Produto";
    productModal.style.display="flex";
}

function editProduct(index){
    editIndex=index;
    let item=inventory[index];
    name.value=item.name;
    price.value=item.pricePerUnit*item.quantityRemaining;
    quantity.value=item.quantityRemaining;
    unit.value=item.unit;
    modalTitle.innerText="Editar Produto";
    productModal.style.display="flex";
}

function saveProduct(){
    let n=name.value.trim();
    let p=parseFloat(price.value);
    let q=parseFloat(quantity.value);
    let u=unit.value;

    if(!n||!p||!q)return;

    let pricePerUnit=p/q;

    if(editIndex!==null){
        inventory[editIndex]={
            name:n,
            priceTotal:p,
            quantityTotal:q,
            quantityRemaining:q,
            unit:u,
            pricePerUnit
        };
    }else{
        let existing=inventory.find(i=>i.name.toLowerCase()===n.toLowerCase());
        if(existing){
            let totalOldValue=existing.pricePerUnit*existing.quantityRemaining;
            let totalNewValue=pricePerUnit*q;
            let newQty=existing.quantityRemaining+q;
            existing.pricePerUnit=(totalOldValue+totalNewValue)/newQty;
            existing.quantityRemaining=newQty;
            existing.quantityTotal+=q;
        }else{
            inventory.push({
                name:n,
                priceTotal:p,
                quantityTotal:q,
                quantityRemaining:q,
                unit:u,
                pricePerUnit
            });
        }
    }

    saveStorage();
    renderAll();
    closeModal();
}

function deleteProduct(index){
    if(confirm("Remover produto?")){
        inventory.splice(index,1);
        saveStorage();
        renderAll();
    }
}

function openMeal(){
    mealItem.innerHTML="";
    inventory.forEach((i,idx)=>{
        mealItem.innerHTML+=`<option value="${idx}">${i.name}</option>`;
    });
    mealModal.style.display="flex";
}

function addMeal(){
    let index=mealItem.value;
    let qty=parseFloat(useQuantity.value);
    let item=inventory[index];

    if(qty>item.quantityRemaining){
        alert("Stock insuficiente");
        return;
    }

    let cost=qty*item.pricePerUnit;
    item.quantityRemaining-=qty;

    meals.push({
        date:new Date().toISOString(),
        product:item.name,
        quantity:qty,
        cost
    });

    saveStorage();
    renderAll();
    closeModal();
}

function closeModal(){
    productModal.style.display="none";
    mealModal.style.display="none";
    name.value="";price.value="";quantity.value="";unit.value="";
}

function renderInventory(){
    inventoryDiv.innerHTML="";
    inventory.forEach((item,index)=>{
        let percent=(item.quantityRemaining/item.quantityTotal)*100;
        let low=percent<=20;
        inventoryDiv.innerHTML+=`
        <div class="card ${low?"low-stock":""}">
        <b>${item.name}</b><br>
        Restante: ${item.quantityRemaining.toFixed(2)} ${item.unit}<br>
        ‚Ç¨/unidade: ‚Ç¨${item.pricePerUnit.toFixed(2)}
        <div class="progress-bar">
        <div class="progress" style="width:${percent}%"></div>
        </div>
        <button class="secondary" onclick="editProduct(${index})">Editar</button>
        <button class="danger" onclick="deleteProduct(${index})">Remover</button>
        </div>`;
    });
}

function renderShopping(){
    shopping.innerHTML="";
    let lowItems=inventory.filter(i=>i.quantityRemaining<=i.quantityTotal*0.2);
    if(lowItems.length===0){
        shopping.innerHTML="<div class='card'>Tudo abastecido üëç</div>";
        return;
    }
    lowItems.forEach(i=>{
        shopping.innerHTML+=`
        <div class="card warning">
        ${i.name} est√° baixo
        </div>`;
    });
}

function renderDashboard(){
    let now=new Date();
    let monthMeals=meals.filter(m=>{
        let d=new Date(m.date);
        return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
    });

    let total=monthMeals.reduce((a,b)=>a+b.cost,0);
    let today=now.getDate();
    let projection=today>0?(total/today)*30:0;
    let percent=(total/salary)*100;

    dashboard.innerHTML=`
    <div class="card">
    üí∞ Este m√™s: ‚Ç¨${total.toFixed(2)}<br>
    üìà Proje√ß√£o: ‚Ç¨${projection.toFixed(2)}<br>
    üéØ Or√ßamento: ‚Ç¨${budget}<br>
    üìä % sal√°rio: ${percent.toFixed(2)}%
    </div>`;
}

function renderHistory(){
    history.innerHTML="";
    meals.slice().reverse().forEach(m=>{
        history.innerHTML+=`
        <div class="card">
        ${new Date(m.date).toLocaleDateString()}<br>
        ${m.product} - ${m.quantity}<br>
        ‚Ç¨${m.cost.toFixed(2)}
        </div>`;
    });
}

function renderAll(){
    renderInventory();
    renderShopping();
    renderDashboard();
    renderHistory();
}

const inventoryDiv=document.getElementById("inventory");
const shopping=document.getElementById("shopping");
const dashboard=document.getElementById("dashboard");
const history=document.getElementById("history");
const productModal=document.getElementById("productModal");
const mealModal=document.getElementById("mealModal");
const name=document.getElementById("name");
const price=document.getElementById("price");
const quantity=document.getElementById("quantity");
const unit=document.getElementById("unit");
const mealItem=document.getElementById("mealItem");
const useQuantity=document.getElementById("useQuantity");
const modalTitle=document.getElementById("modalTitle");

renderAll();

</script>

</body>
</html>
