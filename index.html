<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food Control Pro</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0f0f0f;
    color:#fff;
}
header{
    background:#1b1b1b;
    padding:15px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
}
.container{padding:15px;}

button{
    padding:10px;
    border:none;
    border-radius:8px;
    margin:5px 0;
    cursor:pointer;
}
.primary{background:#00c853;color:#fff;}
.secondary{background:#333;color:#fff;}
.danger{background:#b71c1c;color:#fff;}

.card{
    background:#1b1b1b;
    padding:12px;
    border-radius:10px;
    margin-bottom:10px;
}

input, select{
    width:100%;
    padding:8px;
    margin:5px 0;
    border-radius:6px;
    border:none;
}

.modal{
    display:none;
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}
.modal-content{
    background:#222;
    padding:20px;
    border-radius:10px;
    width:90%;
    max-width:400px;
}
.low-stock{
    border:2px solid #b71c1c;
}
</style>
</head>
<body>

<header>ğŸ² Food Control Pro</header>

<div class="container">

<button class="primary" onclick="openAdd()">+ Produto</button>
<button class="secondary" onclick="openMeal()">+ RefeiÃ§Ã£o</button>

<h3>ğŸ“¦ InventÃ¡rio</h3>
<div id="inventory"></div>

<h3>ğŸ“Š Dashboard</h3>
<div id="dashboard"></div>

<h3>ğŸ“œ HistÃ³rico</h3>
<div id="history"></div>

</div>

<!-- Modal Produto -->
<div class="modal" id="addModal">
<div class="modal-content">
<h3>Adicionar Produto</h3>
<input id="name" placeholder="Nome">
<input id="price" type="number" placeholder="PreÃ§o total â‚¬">
<input id="quantity" type="number" placeholder="Quantidade total">
<input id="unit" placeholder="Unidade (g, kg, un)">
<button class="primary" onclick="saveItem()">Guardar</button>
<button class="secondary" onclick="closeModal()">Cancelar</button>
</div>
</div>

<!-- Modal RefeiÃ§Ã£o -->
<div class="modal" id="mealModal">
<div class="modal-content">
<h3>Registar Consumo</h3>
<select id="mealItem"></select>
<input id="useQuantity" type="number" placeholder="Quantidade usada">
<button class="primary" onclick="addMeal()">Registar</button>
<button class="secondary" onclick="closeModal()">Cancelar</button>
</div>
</div>

<script>

let inventory = JSON.parse(localStorage.getItem("inventory")) || [];
let meals = JSON.parse(localStorage.getItem("meals")) || [];
let salary = 1960;
let budget = 80;

function saveStorage(){
    localStorage.setItem("inventory", JSON.stringify(inventory));
    localStorage.setItem("meals", JSON.stringify(meals));
}

function openAdd(){document.getElementById("addModal").style.display="flex";}
function openMeal(){
    let select=document.getElementById("mealItem");
    select.innerHTML="";
    inventory.forEach((item,i)=>{
        select.innerHTML+=`<option value="${i}">${item.name}</option>`;
    });
    document.getElementById("mealModal").style.display="flex";
}
function closeModal(){
    document.getElementById("addModal").style.display="none";
    document.getElementById("mealModal").style.display="none";
}

function saveItem(){
    let name=nameInput.value;
    let price=parseFloat(priceInput.value);
    let quantity=parseFloat(quantityInput.value);
    let unit=unitInput.value;

    let pricePerUnit=price/quantity;

    inventory.push({
        name,
        priceTotal:price,
        quantityTotal:quantity,
        quantityRemaining:quantity,
        unit,
        pricePerUnit
    });

    saveStorage();
    renderInventory();
    closeModal();
}

const nameInput=document.getElementById("name");
const priceInput=document.getElementById("price");
const quantityInput=document.getElementById("quantity");
const unitInput=document.getElementById("unit");

function addMeal(){
    let index=document.getElementById("mealItem").value;
    let useQuantity=parseFloat(document.getElementById("useQuantity").value);

    let item=inventory[index];
    let cost=useQuantity*item.pricePerUnit;

    item.quantityRemaining-=useQuantity;

    meals.push({
        date:new Date().toISOString(),
        product:item.name,
        quantity:useQuantity,
        cost
    });

    saveStorage();
    renderInventory();
    renderDashboard();
    renderHistory();
    closeModal();
}

function renderInventory(){
    let div=document.getElementById("inventory");
    div.innerHTML="";
    inventory.forEach(item=>{
        let low=item.quantityRemaining <= item.quantityTotal*0.2;
        div.innerHTML+=`
        <div class="card ${low?"low-stock":""}">
        <b>${item.name}</b><br>
        Restante: ${item.quantityRemaining.toFixed(2)} ${item.unit}<br>
        â‚¬/unidade: â‚¬${item.pricePerUnit.toFixed(2)}
        </div>`;
    });
}

function renderDashboard(){

    let now=new Date();
    let month=now.getMonth();
    let year=now.getFullYear();

    let monthMeals=meals.filter(m=>{
        let d=new Date(m.date);
        return d.getMonth()===month && d.getFullYear()===year;
    });

    let total=monthMeals.reduce((a,b)=>a+b.cost,0);

    let today=new Date().getDate();
    let projection=(total/today)*30;

    let weekStart=new Date();
    weekStart.setDate(now.getDate()-7);

    let weekTotal=meals.filter(m=>new Date(m.date)>=weekStart)
                        .reduce((a,b)=>a+b.cost,0);

    let percent=(total/salary)*100;

    document.getElementById("dashboard").innerHTML=`
    <div class="card">
    ğŸ’° Este mÃªs: â‚¬${total.toFixed(2)}<br>
    ğŸ“… Esta semana: â‚¬${weekTotal.toFixed(2)}<br>
    ğŸ“ˆ ProjeÃ§Ã£o mensal: â‚¬${projection.toFixed(2)}<br>
    ğŸ¯ OrÃ§amento: â‚¬${budget}<br>
    ğŸ“Š % salÃ¡rio: ${percent.toFixed(2)}%
    </div>`;
}

function renderHistory(){
    let div=document.getElementById("history");
    div.innerHTML="";
    meals.slice().reverse().forEach(m=>{
        div.innerHTML+=`
        <div class="card">
        ${new Date(m.date).toLocaleDateString()}<br>
        ${m.product} - ${m.quantity} <br>
        â‚¬${m.cost.toFixed(2)}
        </div>`;
    });
}

renderInventory();
renderDashboard();
renderHistory();

</script>
</body>
</html>
